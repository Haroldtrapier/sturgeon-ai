"use strict";(()=>{var e={};e.id=862,e.ids=[862],e.modules={72934:e=>{e.exports=require("next/dist/client/components/action-async-storage.external.js")},54580:e=>{e.exports=require("next/dist/client/components/request-async-storage.external.js")},45869:e=>{e.exports=require("next/dist/client/components/static-generation-async-storage.external.js")},30517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},39491:e=>{e.exports=require("assert")},14300:e=>{e.exports=require("buffer")},6113:e=>{e.exports=require("crypto")},82361:e=>{e.exports=require("events")},13685:e=>{e.exports=require("http")},95687:e=>{e.exports=require("https")},63477:e=>{e.exports=require("querystring")},12781:e=>{e.exports=require("stream")},57310:e=>{e.exports=require("url")},73837:e=>{e.exports=require("util")},59796:e=>{e.exports=require("zlib")},18222:(e,r,t)=>{t.r(r),t.d(r,{headerHooks:()=>x,originalPathname:()=>y,patchFetch:()=>h,requestAsyncStorage:()=>g,routeModule:()=>m,serverHooks:()=>w,staticGenerationAsyncStorage:()=>v,staticGenerationBailout:()=>f});var s={};t.r(s),t.d(s,{GET:()=>d,POST:()=>c});var i=t(10884),a=t(16132),o=t(21040),n=t(95798),u=t(47770),p=t(94020),l=t(59757);async function c(e){try{let r=await (0,p.getServerSession)(l.L);if(!r?.user?.id)return n.Z.json({error:"Unauthorized"},{status:401});let t=await e.json(),{title:s,source:i,externalId:a,status:o}=t;if(!s||!i||!a)return n.Z.json({error:"Missing required fields: title, source, externalId"},{status:400});let{data:c}=await u.O.from("opportunities").select("id").eq("user_id",r.user.id).eq("external_id",a).single();if(c)return n.Z.json({error:"Opportunity already saved"},{status:409});let{data:d,error:m}=await u.O.from("opportunities").insert([{user_id:r.user.id,title:s,agency:t.agency||null,source:i,external_id:a,status:o||"watchlist",metadata:t.metadata||{},created_at:new Date().toISOString()}]).select().single();if(m)throw console.error("Supabase error:",m),m;return n.Z.json({success:!0,data:d,message:"Opportunity saved successfully"})}catch(e){return console.error("Error saving opportunity:",e),n.Z.json({error:"Failed to save opportunity",details:e instanceof Error?e.message:"Unknown error"},{status:500})}}async function d(e){try{let e=await (0,p.getServerSession)(l.L);if(!e?.user?.id)return n.Z.json({error:"Unauthorized"},{status:401});let{data:r,error:t}=await u.O.from("opportunities").select("*").eq("user_id",e.user.id).order("created_at",{ascending:!1});if(t)throw t;return n.Z.json({success:!0,data:r})}catch(e){return console.error("Error fetching opportunities:",e),n.Z.json({error:"Failed to fetch opportunities"},{status:500})}}let m=new i.AppRouteRouteModule({definition:{kind:a.x.APP_ROUTE,page:"/api/opportunities/save/route",pathname:"/api/opportunities/save",filename:"route",bundlePath:"app/api/opportunities/save/route"},resolvedPagePath:"/home/runner/work/sturgeon-ai/sturgeon-ai/app/api/opportunities/save/route.ts",nextConfigOutput:"",userland:s}),{requestAsyncStorage:g,staticGenerationAsyncStorage:v,serverHooks:w,headerHooks:x,staticGenerationBailout:f}=m,y="/api/opportunities/save/route";function h(){return(0,o.patchFetch)({serverHooks:w,staticGenerationAsyncStorage:v})}},47770:(e,r,t)=>{t.d(r,{O:()=>o});var s=t(58617);let i=process.env.NEXT_PUBLIC_SUPABASE_URL,a=process.env.NEXT_PUBLIC_SUPABASE_ANON_KEY,o=(0,s.eI)(i,a)},59757:(e,r,t)=>{t.d(r,{L:()=>p,W:()=>l});var s=t(39448),i=t(49375),a=t(47770);t(96721);var o=t(62421),n=t.n(o);async function u(e,r){return n().compare(e,r)}process.env.JWT_SECRET,process.env.JWT_REFRESH_SECRET;let p={session:{strategy:"jwt"},pages:{signIn:"/login"},providers:[(0,i.Z)({clientId:process.env.GOOGLE_CLIENT_ID||"",clientSecret:process.env.GOOGLE_CLIENT_SECRET||""}),(0,s.Z)({name:"credentials",credentials:{email:{label:"Email",type:"email"},password:{label:"Password",type:"password"}},async authorize(e){if(!e?.email||!e?.password)throw Error("Invalid credentials");let{data:r,error:t}=await a.O.from("users").select("*").eq("email",e.email).single();if(t||!r||!r.password)throw Error("Invalid credentials");let s=await u(e.password,r.password);if(!s)throw Error("Invalid credentials");return{id:r.id,email:r.email,name:r.name,image:r.image}}})],callbacks:{session:async({token:e,session:r})=>(e&&(r.user.id=e.id,r.user.name=e.name,r.user.email=e.email,r.user.image=e.picture),r),jwt:async({token:e,user:r})=>(r&&(e.id=r.id),e)}};async function l(){let{getServerSession:e}=await Promise.resolve().then(t.t.bind(t,94020,23));return e(p)}}};var r=require("../../../../webpack-runtime.js");r.C(e);var t=e=>r(r.s=e),s=r.X(0,[514,617,321,107],()=>t(18222));module.exports=s})();